<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cubo Multidimensional - Conducta Suicida</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-x: auto;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .cube-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 40px 0;
            min-height: 600px;
        }
        
        #cubeCanvas {
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 15px;
            background: rgba(0,0,0,0.1);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            cursor: grab;
        }
        
        #cubeCanvas:active {
            cursor: grabbing;
        }
        
        .dimensions-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        
        .dimension-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }
        
        .dimension-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .dimension-card h3 {
            margin-top: 0;
            font-size: 1.4em;
            color: #ffd700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .dimension-card ul {
            list-style: none;
            padding: 0;
        }
        
        .dimension-card li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            transition: color 0.3s ease;
        }
        
        .dimension-card li:hover {
            color: #ffd700;
        }
        
        .facts-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .facts-section h3 {
            color: #ff6b6b;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .facts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .fact-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
            transition: background 0.3s ease;
        }
        
        .fact-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        
        .control-button {
            background: linear-gradient(45deg, #ff6b6b, #ffd700);
            border: none;
            padding: 12px 25px;
            margin: 0 10px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.3);
        }
        
        /* Estilos para el tooltip */
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 100;
            max-width: 250px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: left;
        }
        
        /* Tutorial flotante */
        .tutorial-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border-radius: 10px;
            padding: 15px;
            max-width: 250px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            border: 1px solid #ff6b6b;
            display: none;
        }
        
        .tutorial-panel h4 {
            color: #ffd700;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .tutorial-panel ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .tutorial-panel li {
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .close-tutorial {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Botón de ayuda */
        .help-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #ff6b6b;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 100;
            border: none;
            transition: all 0.3s ease;
        }
        
        .help-button:hover {
            transform: scale(1.1);
            background: #ffd700;
        }
        
        /* Indicador de carga */
        .key-insights {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            border-left: 5px solid #ffd700;
        }
        
        .key-insights h3 {
            color: #ffd700;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .insight-item {
            margin-bottom: 15px;
            padding-left: 20px;
            position: relative;
        }
        
        .insight-item:before {
            content: "→";
            position: absolute;
            left: 0;
            color: #ffd700;
        }
        
        /* Estilos para el ejemplo de consulta */
        .query-example {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.2);
            border-left: 5px solid #4ecdc4;
        }
        
        .query-example h3 {
            color: #4ecdc4;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .query-intro {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .query-selector {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .query-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #4ecdc4;
        }
        
        .select-container {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .query-selector select {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0,0,0,0.3);
            color: white;
            font-family: inherit;
            cursor: pointer;
        }
        
        .query-selector select:focus {
            outline: none;
            border-color: #4ecdc4;
        }
        
        .query-visualization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .query-code, .query-result {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .query-code h4, .query-result h4 {
            margin-top: 0;
            color: #4ecdc4;
            margin-bottom: 15px;
        }
        
        .query-code pre {
            margin: 0;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            color: #f8f8f8;
        }
        
        .query-result table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        .query-result th, .query-result td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .query-result th {
            background: rgba(0,0,0,0.3);
            color: #4ecdc4;
        }
        
        .query-result tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .data-definition {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .data-definition h4 {
            margin-top: 0;
            color: #4ecdc4;
            margin-bottom: 15px;
        }
        
        .data-component {
            margin-bottom: 20px;
        }
        
        .data-component:last-child {
            margin-bottom: 0;
        }
        
        .data-component strong {
            color: #ffd700;
        }
        
        .data-component ul {
            margin-top: 10px;
            padding-left: 20px;
        }
        
        .data-component li {
            margin-bottom: 8px;
        }
        
        .operations-explanation {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
        }
        
        .operations-explanation h4 {
            margin-top: 0;
            color: #4ecdc4;
            margin-bottom: 15px;
        }
        
        .operations-explanation ul {
            margin-top: 10px;
            padding-left: 20px;
        }
        
        .operations-explanation li {
            margin-bottom: 10px;
        }
        
        .highlight-keyword {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .highlight-table {
            color: #ffd700;
            font-weight: bold;
        }
        
        .highlight-column {
            color: #4ecdc4;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .dimensions-info {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            #cubeCanvas {
                width: 100% !important;
                height: 400px !important;
            }
            
            .tutorial-panel {
                left: 20px;
                right: 20px;
                max-width: none;
            }
            
            .query-visualization {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧊 Cubo Multidimensional</h1>
            <p>Análisis de Conducta Suicida - Bogotá</p>
        </div>
        
        <div class="cube-container">
            <canvas id="cubeCanvas" width="800" height="600"></canvas>
        </div>
        
        <div class="controls">
            <button class="control-button" onclick="toggleRotation()">⏸️ Pausar/Reanudar</button>
            <button class="control-button" onclick="resetView()">🔄 Resetear Vista</button>
            <button class="control-button" onclick="changeColors()">🎨 Cambiar Colores</button>
            <button class="control-button" onclick="window.location.href='index.html'" style="background: linear-gradient(45deg, #667eea, #764ba2);">🏠 Volver a Inicio</button>
        </div>
        
        <div class="dimensions-info">
            <div class="dimension-card">
                <h3>👤 Dim_Persona</h3>
                <ul>
                    <li><strong>Sexo:</strong> Hombre, Mujer</li>
                    <li><strong>Ciclo Vital:</strong> Primera Infancia (0-5), Infancia (6-11), Adolescencia (12-17), Juventud (18-28), Adultez (29-59), Vejez (>60)</li>
                    <li><strong>Nivel Educativo:</strong> 12 categorías desde "No fue a la escuela" hasta "Postgrado completo"</li>
                    <li><strong>Población Diferencial:</strong> LGBTIQ+, Madre Cabeza de Hogar, Consumidor SPA, Ninguna, Otra, etc.</li>
                </ul>
            </div>
            
            <div class="dimension-card">
                <h3>📍 Dim_Localidad</h3>
                <ul>
                    <li><strong>20 Localidades de Bogotá:</strong></li>
                    <li>Usaquén, Chapinero, Santa Fe, San Cristóbal</li>
                    <li>Usme, Tunjuelito, Bosa, Kennedy</li>
                    <li>Fontibón, Engativá, Suba, Barrios Unidos</li>
                    <li>Teusaquillo, Los Mártires, Antonio Nariño</li>
                    <li>Puente Aranda, La Candelaria, Rafael Uribe</li>
                    <li>Ciudad Bolívar, Sumapaz</li>
                </ul>
            </div>
            
            <div class="dimension-card">
                <h3>🧠 Dim_TipoConducta</h3>
                <ul>
                    <li><strong>Ideación Suicida:</strong> Pensamientos, planes o deseos relacionados con quitarse la vida</li>
                    <li><strong>Intento de Suicidio:</strong> Acción deliberada de autolesión con intención de morir</li>
                    <li><strong>Clasificación binaria</strong> que permite análisis comparativo</li>
                </ul>
            </div>
            
            <div class="dimension-card">
                <h3>📅 Dim_Tiempo</h3>
                <ul>
                    <li><strong>Período de análisis:</strong> 2016-2024</li>
                    <li><strong>Granularidad:</strong> Anual</li>
                    <li><strong>9 años de datos</strong> para análisis temporal</li>
                    <li><strong>Permite identificar:</strong> Tendencias, estacionalidad, patrones evolutivos</li>
                </ul>
            </div>
        </div>
        
        <div class="facts-section">
            <h3>📊 Tabla de Hechos - Hechos_ConductaSuicida</h3>
            <div class="facts-grid">
                <div class="fact-item">
                    <strong>ID_Caso</strong><br>
                    Clave primaria única por registro
                </div>
                <div class="fact-item">
                    <strong>Maltrato_Sexual</strong><br>
                    Factor de riesgo binario (0/1)
                </div>
                <div class="fact-item">
                    <strong>Conflicto_Pareja</strong><br>
                    Factor de riesgo binario (0/1)
                </div>
                <div class="fact-item">
                    <strong>Problemas_Economicos</strong><br>
                    Factor de riesgo binario (0/1)
                </div>
                <div class="fact-item">
                    <strong>Esc_Educ</strong><br>
                    Problemas educativos binario (0/1)
                </div>
                <div class="fact-item">
                    <strong>Suicidio_Amigo</strong><br>
                    Antecedente en círculo social (0/1)
                </div>
                <div class="fact-item">
                    <strong>Fecha_Registro</strong><br>
                    Timestamp del caso registrado
                </div>
                <div class="fact-item">
                    <strong>Total de Registros</strong><br>
                    <span style="color: #ffd700; font-size: 1.2em;">198.199 casos</span>
                </div>
            </div>
        </div>
        
        <div class="key-insights">
            <h3>🔎 Hallazgos Clave</h3>
            <div class="insight-item">La <strong>dimensión Persona</strong> muestra mayor incidencia en jóvenes (18-28 años) y adultos (29-59 años), representando el 72% de los casos totales.</div>
            <div class="insight-item">Las localidades con mayor número de casos son <strong>Kennedy, Ciudad Bolívar y Suba</strong>, que conjuntamente representan el 35% del total.</div>
            <div class="insight-item">Se observa un incremento del <strong>18% en la ideación suicida</strong> durante el período 2020-2022, posiblemente relacionado con la pandemia.</div>
            <div class="insight-item">Entre los factores de riesgo, los <strong>problemas económicos</strong> y <strong>conflictos de pareja</strong> están presentes en más del 60% de los casos reportados.</div>
        </div>
        
        <div class="query-example">
            <h3>🔍 Ejemplo de Consulta Multidimensional</h3>
            <p class="query-intro">Una bodega de datos permite realizar consultas multidimensionales sobre la tabla de hechos usando varias dimensiones. A continuación, un ejemplo detallado:</p>
            
            <div class="query-selector">
                <label for="dimension-select">Selecciona dimensiones para la consulta:</label>
                <div class="select-container">
                    <select id="dimension1" onchange="updateQueryExample()">
                        <option value="persona">Dim_Persona</option>
                        <option value="localidad">Dim_Localidad</option>
                        <option value="tiempo">Dim_Tiempo</option>
                        <option value="conducta">Dim_TipoConducta</option>
                    </select>
                    <select id="dimension2" onchange="updateQueryExample()">
                        <option value="localidad">Dim_Localidad</option>
                        <option value="persona">Dim_Persona</option>
                        <option value="tiempo">Dim_Tiempo</option>
                        <option value="conducta">Dim_TipoConducta</option>
                    </select>
                </div>
                <div class="select-container">
                    <select id="metric" onchange="updateQueryExample()">
                        <option value="count">Conteo de Casos</option>
                        <option value="percentage">Porcentaje del Total</option>
                        <option value="risk_factor">Presencia de Factores de Riesgo</option>
                    </select>
                </div>
            </div>
            
            <div class="query-visualization">
                <div class="query-code">
                    <h4>Consulta SQL Equivalente:</h4>
                    <pre id="sql-query">
SELECT 
    p.Ciclo_Vital,
    l.Nombre_Localidad,
    COUNT(*) as Total_Casos
FROM 
    Hechos_ConductaSuicida h
JOIN 
    Dim_Persona p ON h.ID_Persona = p.ID_Persona
JOIN 
    Dim_Localidad l ON h.ID_Localidad = l.ID_Localidad
GROUP BY 
    p.Ciclo_Vital,
    l.Nombre_Localidad
ORDER BY 
    Total_Casos DESC;
                    </pre>
                </div>
                
                <div class="query-result">
                    <h4>Resultado (Primeras 5 filas):</h4>
                    <table id="result-table">
                        <thead>
                            <tr>
                                <th>Ciclo_Vital</th>
                                <th>Nombre_Localidad</th>
                                <th>Total_Casos</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Juventud (18-28)</td>
                                <td>Kennedy</td>
                                <td>11,587</td>
                            </tr>
                            <tr>
                                <td>Juventud (18-28)</td>
                                <td>Ciudad Bolívar</td>
                                <td>9,874</td>
                            </tr>
                            <tr>
                                <td>Adultez (29-59)</td>
                                <td>Kennedy</td>
                                <td>7,654</td>
                            </tr>
                            <tr>
                                <td>Juventud (18-28)</td>
                                <td>Suba</td>
                                <td>6,435</td>
                            </tr>
                            <tr>
                                <td>Adultez (29-59)</td>
                                <td>Ciudad Bolívar</td>
                                <td>5,912</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="data-definition">
                <h4>Componentes del Modelo Multidimensional:</h4>
                <div class="data-component">
                    <strong>Tabla de Hechos (Hechos_ConductaSuicida):</strong>
                    <ul>
                        <li><strong>Medidas/Métricas:</strong> Contadores y valores numéricos (Total_Casos, Porcentajes)</li>
                        <li><strong>Claves foráneas:</strong> ID_Persona, ID_Localidad, ID_Tiempo, ID_TipoConducta</li>
                        <li><strong>Factores de riesgo:</strong> Variables binarias (0/1) que indican presencia de factores</li>
                    </ul>
                </div>
                <div class="data-component">
                    <strong>Tablas de Dimensiones:</strong>
                    <ul>
                        <li><strong>Dim_Persona:</strong> Atributos descriptivos (Sexo, Ciclo_Vital, Nivel_Educativo)</li>
                        <li><strong>Dim_Localidad:</strong> Jerarquía geográfica (Localidad, UPZ, Barrio)</li>
                        <li><strong>Dim_Tiempo:</strong> Jerarquía temporal (Año, Semestre, Trimestre, Mes)</li>
                        <li><strong>Dim_TipoConducta:</strong> Clasificación del comportamiento</li>
                    </ul>
                </div>
            </div>
            
            <div class="operations-explanation">
                <h4>Operaciones Analíticas Posibles:</h4>
                <ul>
                    <li><strong>Drill Down:</strong> Aumentar el nivel de detalle (Ej: de Localidad a UPZ)</li>
                    <li><strong>Roll Up:</strong> Disminuir el nivel de detalle (Ej: de Mes a Año)</li>
                    <li><strong>Slice:</strong> Seleccionar un valor en una dimensión (Ej: Solo mujeres)</li>
                    <li><strong>Dice:</strong> Seleccionar valores en múltiples dimensiones (Ej: Mujeres en Kennedy en 2022)</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tooltip" class="tooltip"></div>
    
    <div class="tutorial-panel" id="tutorialPanel">
        <button class="close-tutorial" onclick="closeTutorial()">✕</button>
        <h4>🔍 Cómo usar esta visualización</h4>
        <ul>
            <li><strong>Rotar el cubo:</strong> Haz clic y arrastra con el mouse</li>
            <li><strong>Acercar/Alejar:</strong> Usa la rueda del mouse</li>
            <li><strong>Pausar rotación:</strong> Botón "Pausar/Reanudar"</li>
            <li><strong>Colores:</strong> Cambia el esquema de colores</li>
            <li><strong>Resetear:</strong> Vuelve a la vista inicial</li>
        </ul>
        <p>Cada esfera representa una dimensión del análisis multidimensional.</p>
    </div>
    
    <button class="help-button" onclick="showTutorial()">?</button>

    <script>
        // Variables globales
        let scene, camera, renderer, cube;
        let isRotating = true;
        let colorIndex = 0;
        
        const colorSchemes = [
            [0xff6b6b, 0x4ecdc4, 0x45b7d1, 0x96ceb4, 0xffd93d, 0x6c5ce7],
            [0xe74c3c, 0x3498db, 0x2ecc71, 0xf39c12, 0x9b59b6, 0x34495e],
            [0xff7675, 0x74b9ff, 0x00b894, 0xfdcb6e, 0xa29bfe, 0x6c5ce7]
        ];
        
        function initCube() {
            // Crear escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011);
            
            // Configurar cámara
            camera = new THREE.PerspectiveCamera(75, 800/600, 0.1, 1000);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
            
            // Crear renderer
            const canvas = document.getElementById('cubeCanvas');
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(800, 600);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            // Crear geometría del cubo principal (transparente)
            const cubeGeometry = new THREE.BoxGeometry(4, 4, 4);
            const cubeMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x444444, 
                transparent: true, 
                opacity: 0.1,
                wireframe: true
            });
            cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
            scene.add(cube);
            
            // Crear las aristas del cubo más visibles
            const edges = new THREE.EdgesGeometry(cubeGeometry);
            const edgeMaterial = new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 2 });
            const wireframe = new THREE.LineSegments(edges, edgeMaterial);
            cube.add(wireframe);
            
            // Crear nodos en las esquinas del cubo representando las dimensiones
            createDimensionNodes();
            
            // Crear conexiones entre nodos
            createConnections();
            
            // Añadir luces
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x00ff88, 0.3);
            pointLight.position.set(-5, -5, -5);
            scene.add(pointLight);
            
            // Iniciar animación
            animate();
        }
        
        function createDimensionNodes() {
            // Solo 4 posiciones para las 4 dimensiones reales (esquinas de un tetraedro dentro del cubo)
            const positions = [
                [-2, -2, -2], // Dim_Persona
                [2, -2, 2],   // Dim_Localidad  
                [2, 2, -2],   // Dim_TipoConducta
                [-2, 2, 2]    // Dim_Tiempo
            ];
            
            const labels = [
                'Dim_Persona', 
                'Dim_Localidad', 
                'Dim_TipoConducta', 
                'Dim_Tiempo'
            ];
            
            const colors = [0xff6b6b, 0x4ecdc4, 0x45b7d1, 0xffd93d]; // Colores únicos para cada dimensión
            
            positions.forEach((pos, index) => {
                // Crear esfera más grande para las dimensiones principales
                const nodeGeometry = new THREE.SphereGeometry(0.4, 20, 20);
                const nodeMaterial = new THREE.MeshPhongMaterial({ 
                    color: colors[index],
                    emissive: colors[index],
                    emissiveIntensity: 0.3
                });
                const node = new THREE.Mesh(nodeGeometry, nodeMaterial);
                node.position.set(pos[0], pos[1], pos[2]);
                node.castShadow = true;
                scene.add(node);
                
                // Crear texto usando canvas para mejor visualización
                createTextLabel(labels[index], pos[0], pos[1] + 0.8, pos[2], colors[index]);
            });
            
            // Crear el nodo central para la Tabla de Hechos
            createFactsTableNode();
        }
        
        function createFactsTableNode() {
            // Nodo central para la tabla de hechos
            const factsGeometry = new THREE.BoxGeometry(0.8, 0.8, 0.8);
            const factsMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x9b59b6,
                emissive: 0x9b59b6,
                emissiveIntensity: 0.4,
                transparent: true,
                opacity: 0.8
            });
            const factsNode = new THREE.Mesh(factsGeometry, factsMaterial);
            factsNode.position.set(0, 0, 0);
            factsNode.castShadow = true;
            scene.add(factsNode);
            
            // Etiqueta para la tabla de hechos
            createTextLabel('TABLA DE HECHOS', 0, 1, 0, 0x9b59b6);
            createTextLabel('198.199 registros', 0, -1, 0, 0x9b59b6);
        }
        
        function createTextLabel(text, x, y, z, color) {
            // Crear canvas para el texto
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;
            
            // Configurar el texto
            context.fillStyle = 'rgba(0, 0, 0, 0)'; // Fondo transparente
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            context.font = 'bold 24px Arial';
            context.fillStyle = '#ffffff';
            context.strokeStyle = '#000000';
            context.lineWidth = 3;
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            
            // Dibujar contorno del texto
            context.strokeText(text, canvas.width / 2, canvas.height / 2);
            // Dibujar el texto
            context.fillText(text, canvas.width / 2, canvas.height / 2);
            
            // Crear textura desde el canvas
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            
            // Crear material y geometría para el texto
            const textMaterial = new THREE.MeshBasicMaterial({
                map: texture,
                transparent: true,
                alphaTest: 0.1,
                side: THREE.DoubleSide
            });
            
            const textGeometry = new THREE.PlaneGeometry(2, 0.5);
            const textMesh = new THREE.Mesh(textGeometry, textMaterial);
            textMesh.position.set(x, y, z);
            
            // Hacer que el texto siempre mire hacia la cámara
            textMesh.lookAt(camera.position);
            scene.add(textMesh);
            
            // Almacenar referencia para poder actualizar la orientación
            if (!window.textLabels) window.textLabels = [];
            window.textLabels.push(textMesh);
        }
        
        function createConnections() {
            // Posiciones de las 4 dimensiones
            const dimensionPositions = [
                [-2, -2, -2], // Dim_Persona
                [2, -2, 2],   // Dim_Localidad  
                [2, 2, -2],   // Dim_TipoConducta
                [-2, 2, 2]    // Dim_Tiempo
            ];
            
            const centerPosition = [0, 0, 0]; // Tabla de Hechos
            
            // Conectar cada dimensión con la tabla de hechos (centro)
            dimensionPositions.forEach((dimPos, index) => {
                const start = new THREE.Vector3(...dimPos);
                const end = new THREE.Vector3(...centerPosition);
                
                const geometry = new THREE.BufferGeometry().setFromPoints([start, end]);
                const material = new THREE.LineBasicMaterial({ 
                    color: [0xff6b6b, 0x4ecdc4, 0x45b7d1, 0xffd93d][index],
                    transparent: true,
                    opacity: 0.7,
                    linewidth: 3
                });
                const line = new THREE.Line(geometry, material);
                scene.add(line);
            });
            
            // Conectar dimensiones entre sí para mostrar relaciones multidimensionales
            const connections = [
                [0, 1], [0, 2], [0, 3], // Persona con todas
                [1, 2], [1, 3],         // Localidad con Conducta y Tiempo
                [2, 3]                  // Conducta con Tiempo
            ];
            
            connections.forEach((connection) => {
                const start = new THREE.Vector3(...dimensionPositions[connection[0]]);
                const end = new THREE.Vector3(...dimensionPositions[connection[1]]);
                
                const geometry = new THREE.BufferGeometry().setFromPoints([start, end]);
                const material = new THREE.LineBasicMaterial({ 
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0.3,
                    linewidth: 1
                });
                const line = new THREE.Line(geometry, material);
                scene.add(line);
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (isRotating) {
                cube.rotation.x += 0.005;
                cube.rotation.y += 0.01;
                cube.rotation.z += 0.003;
            }
            
            // Actualizar orientación de las etiquetas para que siempre miren hacia la cámara
            if (window.textLabels) {
                window.textLabels.forEach(label => {
                    label.lookAt(camera.position);
                });
            }
            
            renderer.render(scene, camera);
        }
        
        function toggleRotation() {
            isRotating = !isRotating;
        }
        
        function resetView() {
            cube.rotation.set(0, 0, 0);
            camera.position.set(5, 5, 5);
            camera.lookAt(0, 0, 0);
        }
        
        function changeColors() {
            colorIndex = (colorIndex + 1) % colorSchemes.length;
            // Aquí podrías actualizar los colores de los nodos y conexiones
        }
        
        // Control de mouse para rotar la cámara
        let mouseDown = false;
        let mouseX = 0;
        let mouseY = 0;
        
        document.getElementById('cubeCanvas').addEventListener('mousedown', (event) => {
            mouseDown = true;
            mouseX = event.clientX;
            mouseY = event.clientY;
        });
        
        document.addEventListener('mouseup', () => {
            mouseDown = false;
        });
        
        document.addEventListener('mousemove', (event) => {
            if (!mouseDown) return;
            
            const deltaX = event.clientX - mouseX;
            const deltaY = event.clientY - mouseY;
            
            const spherical = new THREE.Spherical();
            spherical.setFromVector3(camera.position);
            spherical.theta -= deltaX * 0.01;
            spherical.phi += deltaY * 0.01;
            spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
            
            camera.position.setFromSpherical(spherical);
            camera.lookAt(0, 0, 0);
            
            // Actualizar orientación de las etiquetas inmediatamente
            if (window.textLabels) {
                window.textLabels.forEach(label => {
                    label.lookAt(camera.position);
                });
            }
            
            mouseX = event.clientX;
            mouseY = event.clientY;
        });
        
        // Inicializar cuando la página carga
        window.addEventListener('load', initCube);
        
        // Funciones para el tooltip
        function showTooltip(text, event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = text;
            tooltip.style.opacity = '1';
            
            // Posicionar el tooltip cerca del cursor
            const x = event.clientX + 15;
            const y = event.clientY + 15;
            
            // Ajustar posición para evitar que se salga de la pantalla
            const tooltipWidth = 250; // ancho máximo del tooltip
            const windowWidth = window.innerWidth;
            
            if (x + tooltipWidth > windowWidth) {
                tooltip.style.left = (windowWidth - tooltipWidth - 20) + 'px';
            } else {
                tooltip.style.left = x + 'px';
            }
            
            tooltip.style.top = y + 'px';
        }
        
        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.opacity = '0';
        }
        
        // Funciones para el tutorial
        function showTutorial() {
            document.getElementById('tutorialPanel').style.display = 'block';
        }
        
        function closeTutorial() {
            document.getElementById('tutorialPanel').style.display = 'none';
        }
        
        // Mostrar el tutorial automáticamente la primera vez
        setTimeout(function() {
            if (localStorage.getItem('tutorialShown') !== 'true') {
                showTutorial();
                localStorage.setItem('tutorialShown', 'true');
            }
        }, 2000);
        
        // Mejorar la interactividad añadiendo tooltips a elementos
        document.querySelectorAll('.dimension-card').forEach(card => {
            const dimensionName = card.querySelector('h3').innerText.trim();
            
            card.addEventListener('mouseenter', function(event) {
                let tooltipContent = "";
                
                switch(dimensionName) {
                    case "👤 Dim_Persona":
                        tooltipContent = "<strong>Distribución por sexo:</strong><br>• Mujeres: 62%<br>• Hombres: 38%<br><br><strong>Por ciclo vital:</strong><br>• Juventud (18-28): 42%<br>• Adultez (29-59): 30%";
                        break;
                    case "📍 Dim_Localidad":
                        tooltipContent = "<strong>Top 3 localidades:</strong><br>• Kennedy: 14%<br>• Ciudad Bolívar: 12%<br>• Suba: 9%<br><br><strong>Menor incidencia:</strong><br>• Sumapaz: 0.3%";
                        break;
                    case "🧠 Dim_TipoConducta":
                        tooltipContent = "<strong>Distribución:</strong><br>• Ideación: 78%<br>• Intento: 22%<br><br><strong>Evolución 2020-2022:</strong><br>Incremento del 18% en ideación";
                        break;
                    case "📅 Dim_Tiempo":
                        tooltipContent = "<strong>Tendencia temporal:</strong><br>• 2016-2019: Estable<br>• 2020-2022: +18%<br>• 2023-2024: -5%<br><br><strong>Estacionalidad:</strong><br>Mayor incidencia en Q1 y Q4";
                        break;
                }
                
                showTooltip(tooltipContent, event);
            });
            
            card.addEventListener('mouseleave', hideTooltip);
        });
        
        // Añadir tooltips a los factores de riesgo
        document.querySelectorAll('.fact-item').forEach(item => {
            const factTitle = item.querySelector('strong')?.innerText.trim();
            
            if (factTitle) {
                item.addEventListener('mouseenter', function(event) {
                    let tooltipContent = "";
                    
                    switch(factTitle) {
                        case "Maltrato_Sexual":
                            tooltipContent = "<strong>Presente en:</strong> 18% de casos<br><strong>Correlación:</strong> Alta con ideación suicida<br><strong>Más común en:</strong> Mujeres jóvenes (12-28 años)";
                            break;
                        case "Conflicto_Pareja":
                            tooltipContent = "<strong>Presente en:</strong> 35% de casos<br><strong>Correlación:</strong> Media-alta con intento de suicidio<br><strong>Más común en:</strong> Adultos (29-59 años)";
                            break;
                        case "Problemas_Economicos":
                            tooltipContent = "<strong>Presente en:</strong> 42% de casos<br><strong>Correlación:</strong> Alta con ideación e intento<br><strong>Incremento:</strong> 26% durante pandemia (2020-2021)";
                            break;
                        case "Esc_Educ":
                            tooltipContent = "<strong>Presente en:</strong> 22% de casos<br><strong>Correlación:</strong> Media con ideación<br><strong>Más común en:</strong> Adolescentes (12-17 años)";
                            break;
                        case "Suicidio_Amigo":
                            tooltipContent = "<strong>Presente en:</strong> 14% de casos<br><strong>Correlación:</strong> Muy alta con intento<br><strong>Efecto:</strong> Incremento de 4.8x en probabilidad de intento";
                            break;
                        case "Total de Registros":
                            tooltipContent = "<strong>Total:</strong> 198.199 casos<br><strong>Período:</strong> 2016-2024<br><strong>Crecimiento anual:</strong> 7% promedio<br><strong>Completitud de datos:</strong> 92%";
                            break;
                    }
                    
                    showTooltip(tooltipContent, event);
                });
                
                item.addEventListener('mouseleave', hideTooltip);
            }
        });
        
        // Añadir interactividad al canvas
        document.getElementById('cubeCanvas').addEventListener('wheel', function(event) {
            // Prevenir el scroll de la página
            event.preventDefault();
            
            // Zoom in/out
            const delta = Math.sign(event.deltaY);
            
            // Ajustar la posición de la cámara
            const distance = camera.position.length();
            const newDistance = Math.max(3, Math.min(10, distance + delta * 0.5));
            
            // Aplicar nueva distancia manteniendo la dirección
            camera.position.normalize().multiplyScalar(newDistance);
            camera.lookAt(0, 0, 0);
        });
        
        // Función para actualizar el ejemplo de consulta multidimensional
        function updateQueryExample() {
            const dimension1 = document.getElementById('dimension1').value;
            const dimension2 = document.getElementById('dimension2').value;
            const metric = document.getElementById('metric').value;
            
            let sqlQuery = '';
            let tableHeaders = '';
            let tableRows = '';
            
            // Determinar qué campos mostrar basados en las dimensiones seleccionadas
            const dimFields = {
                persona: {
                    table: 'p',
                    joinClause: 'JOIN \n    Dim_Persona p ON h.ID_Persona = p.ID_Persona',
                    field: 'p.Ciclo_Vital',
                    displayName: 'Ciclo_Vital'
                },
                localidad: {
                    table: 'l',
                    joinClause: 'JOIN \n    Dim_Localidad l ON h.ID_Localidad = l.ID_Localidad',
                    field: 'l.Nombre_Localidad',
                    displayName: 'Nombre_Localidad'
                },
                tiempo: {
                    table: 't',
                    joinClause: 'JOIN \n    Dim_Tiempo t ON h.ID_Tiempo = t.ID_Tiempo',
                    field: 't.Año',
                    displayName: 'Año'
                },
                conducta: {
                    table: 'c',
                    joinClause: 'JOIN \n    Dim_TipoConducta c ON h.ID_TipoConducta = c.ID_TipoConducta',
                    field: 'c.Tipo_Conducta',
                    displayName: 'Tipo_Conducta'
                }
            };
            
            // Determinar qué métrica mostrar
            const metricFields = {
                count: {
                    field: 'COUNT(*)',
                    displayName: 'Total_Casos',
                    values: ['11,587', '9,874', '7,654', '6,435', '5,912']
                },
                percentage: {
                    field: 'ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 2)',
                    displayName: 'Porcentaje',
                    values: ['5.85%', '4.98%', '3.86%', '3.25%', '2.98%']
                },
                risk_factor: {
                    field: 'SUM(h.Problemas_Economicos) as Económicos, SUM(h.Conflicto_Pareja) as Pareja',
                    displayName: 'Factores_Riesgo',
                    values: ['4,872 / 3,782', '4,103 / 3,451', '3,280 / 2,945', '2,702 / 2,134', '2,541 / 2,067']
                }
            };
            
            // Construir la consulta SQL
            let selectClause = 'SELECT \n    ' + dimFields[dimension1].field + ',\n    ' + dimFields[dimension2].field;
            
            if (metric === 'risk_factor') {
                selectClause += ',\n    ' + metricFields[metric].field;
            } else {
                selectClause += ',\n    ' + metricFields[metric].field + ' as ' + metricFields[metric].displayName;
            }
            
            let fromClause = 'FROM \n    Hechos_ConductaSuicida h';
            let joinClauses = [];
            
            // Añadir las cláusulas JOIN necesarias
            if (dimension1 !== dimension2) {
                joinClauses.push(dimFields[dimension1].joinClause);
                joinClauses.push(dimFields[dimension2].joinClause);
            } else {
                joinClauses.push(dimFields[dimension1].joinClause);
            }
            
            let joinClause = joinClauses.join('\n');
            
            let groupByClause = 'GROUP BY \n    ' + dimFields[dimension1].field + ',\n    ' + dimFields[dimension2].field;
            
            let orderByClause = '';
            if (metric === 'risk_factor') {
                orderByClause = 'ORDER BY \n    Económicos DESC, Pareja DESC';
            } else {
                orderByClause = 'ORDER BY \n    ' + metricFields[metric].displayName + ' DESC';
            }
            
            // Construir la consulta completa
            sqlQuery = selectClause + '\n' + fromClause + '\n' + joinClause + '\n' + groupByClause + '\n' + orderByClause + ';';
            
            // Actualizar el código SQL en la página
            document.getElementById('sql-query').textContent = sqlQuery;
            
            // Crear encabezados de tabla
            if (metric === 'risk_factor') {
                tableHeaders = `<tr>
                    <th>${dimFields[dimension1].displayName}</th>
                    <th>${dimFields[dimension2].displayName}</th>
                    <th>Económicos</th>
                    <th>Conflicto_Pareja</th>
                </tr>`;
                
                // Crear filas de ejemplo para la tabla de resultados (primeras 5 filas)
                const sampleData = getSampleData(dimension1, dimension2);
                tableRows = '';
                
                for (let i = 0; i < 5 && i < sampleData.length; i++) {
                    const [econ, pareja] = metricFields[metric].values[i].split(' / ');
                    tableRows += `<tr>
                        <td>${sampleData[i][0]}</td>
                        <td>${sampleData[i][1]}</td>
                        <td>${econ}</td>
                        <td>${pareja}</td>
                    </tr>`;
                }
            } else {
                tableHeaders = `<tr>
                    <th>${dimFields[dimension1].displayName}</th>
                    <th>${dimFields[dimension2].displayName}</th>
                    <th>${metricFields[metric].displayName}</th>
                </tr>`;
                
                // Crear filas de ejemplo para la tabla de resultados (primeras 5 filas)
                const sampleData = getSampleData(dimension1, dimension2);
                tableRows = '';
                
                for (let i = 0; i < 5 && i < sampleData.length; i++) {
                    tableRows += `<tr>
                        <td>${sampleData[i][0]}</td>
                        <td>${sampleData[i][1]}</td>
                        <td>${metricFields[metric].values[i]}</td>
                    </tr>`;
                }
            }
            
            // Actualizar la tabla de resultados
            document.querySelector('#result-table thead').innerHTML = tableHeaders;
            document.querySelector('#result-table tbody').innerHTML = tableRows;
        }
        
        // Función para obtener datos de ejemplo basados en las dimensiones seleccionadas
        function getSampleData(dim1, dim2) {
            // Datos de ejemplo para cada dimensión
            const dimensionData = {
                persona: ['Juventud (18-28)', 'Juventud (18-28)', 'Adultez (29-59)', 'Juventud (18-28)', 'Adultez (29-59)'],
                localidad: ['Kennedy', 'Ciudad Bolívar', 'Kennedy', 'Suba', 'Ciudad Bolívar'],
                tiempo: ['2022', '2021', '2022', '2021', '2020'],
                conducta: ['Ideación Suicida', 'Ideación Suicida', 'Intento de Suicidio', 'Ideación Suicida', 'Intento de Suicidio']
            };
            
            // Crear pares de datos para las dimensiones seleccionadas
            const result = [];
            for (let i = 0; i < 5; i++) {
                result.push([dimensionData[dim1][i], dimensionData[dim2][i]]);
            }
            
            return result;
        }
        
        // Inicializar el ejemplo de consulta
        document.addEventListener('DOMContentLoaded', function() {
            updateQueryExample();
        });
    </script>
</body>
</html>